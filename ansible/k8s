---
- hosts: k8s
  tasks:
    - name: apt-get update
      apt:
        update_cache: yes
    - name: apt-get install pkgs
      apt:
        name: "{{ packages }}"
      vars:
        packages:
        - apt-transport-https
        - curl
    - name: curl from google
      shell: curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
    - name: add kube repo
      shell: echo "deb https://apt.kubernetes.io/ kubernetes-xenial main" > /etc/apt/sources.list.d/kubernetes.list
    - name: apt-get update
      shell:  apt-get update
    - name: install kubelets
      shell:  apt-get install -y kubelet kubeadm kubectl
    - name: apk-mark hold
      shell: apt-mark hold kubelet kubeadm kubectl
    - name: daemon reload
      shell: systemctl daemon-reload
    - name: restart kubelet
      shell: systemctl restart kubelet
